///************************************************
/// Generated by: LinhDH
/// Date: 26/10/2012 11:54:07
/// Goal: Create Form for GD_NHAC_VIEC
///************************************************


using System;
using System.Data;
using System.Drawing;
using System.Collections;
using System.ComponentModel;
using System.Windows.Forms;

using IP.Core.IPCommon;
using IP.Core.IPException;
using IP.Core.IPData;
using IP.Core.IPUserService;

using BondUS;
using BondDS;
using BondDS.CDBNames;

using C1.Win.C1FlexGrid;
using IP.Core.IPSystemAdmin;

namespace BondApp
{



	public class f800_rpt_nhac_viec : System.Windows.Forms.Form
	{
        internal System.Windows.Forms.ImageList ImageList;
        private C1.Win.C1FlexGrid.C1FlexGrid m_fg;
        private GroupBox groupBox1;
        private Button m_cmd_them_ghi_chu;
        private Label m_lbl_title;
        private Label m_lbl_lich_nhac_viec_tu;
        private CheckBox m_chk_da_thuc_hien;
        private Label m_lbl_lich_nhac_viec_den;
        private Button m_cmd_filter;
        private DateTimePicker m_dat_from_date;
        private Label label3;
        private DateTimePicker m_dat_to_date;
        private ComboBox m_cbo_loai_nhac_viec;
		private System.ComponentModel.IContainer components;

		public f800_rpt_nhac_viec()
		{
			//
			// Required for Windows Form Designer support
			//
			InitializeComponent();

			//
			// TODO: Add any constructor code after InitializeComponent call
			//
			format_controls();
		}

		/// <summary>
		/// Clean up any resources being used.
		/// </summary>
		protected override void Dispose( bool disposing )
		{
			if( disposing )
			{
				if(components != null)
				{
					components.Dispose();
				}
			}
			base.Dispose( disposing );
		}

		#region Windows Form Designer generated code
		/// <summary>
		/// Required method for Designer support - do not modify
		/// the contents of this method with the code editor.
		/// </summary>
		private void InitializeComponent()
		{
            this.components = new System.ComponentModel.Container();
            System.ComponentModel.ComponentResourceManager resources = new System.ComponentModel.ComponentResourceManager(typeof(f800_rpt_nhac_viec));
            this.ImageList = new System.Windows.Forms.ImageList(this.components);
            this.m_fg = new C1.Win.C1FlexGrid.C1FlexGrid();
            this.groupBox1 = new System.Windows.Forms.GroupBox();
            this.m_cmd_them_ghi_chu = new System.Windows.Forms.Button();
            this.m_lbl_title = new System.Windows.Forms.Label();
            this.m_lbl_lich_nhac_viec_tu = new System.Windows.Forms.Label();
            this.m_chk_da_thuc_hien = new System.Windows.Forms.CheckBox();
            this.m_lbl_lich_nhac_viec_den = new System.Windows.Forms.Label();
            this.m_cmd_filter = new System.Windows.Forms.Button();
            this.m_dat_from_date = new System.Windows.Forms.DateTimePicker();
            this.label3 = new System.Windows.Forms.Label();
            this.m_dat_to_date = new System.Windows.Forms.DateTimePicker();
            this.m_cbo_loai_nhac_viec = new System.Windows.Forms.ComboBox();
            ((System.ComponentModel.ISupportInitialize)(this.m_fg)).BeginInit();
            this.groupBox1.SuspendLayout();
            this.SuspendLayout();
            // 
            // ImageList
            // 
            this.ImageList.ImageStream = ((System.Windows.Forms.ImageListStreamer)(resources.GetObject("ImageList.ImageStream")));
            this.ImageList.TransparentColor = System.Drawing.Color.Transparent;
            this.ImageList.Images.SetKeyName(0, "");
            this.ImageList.Images.SetKeyName(1, "");
            this.ImageList.Images.SetKeyName(2, "");
            this.ImageList.Images.SetKeyName(3, "");
            this.ImageList.Images.SetKeyName(4, "");
            this.ImageList.Images.SetKeyName(5, "");
            this.ImageList.Images.SetKeyName(6, "");
            this.ImageList.Images.SetKeyName(7, "");
            this.ImageList.Images.SetKeyName(8, "");
            this.ImageList.Images.SetKeyName(9, "");
            this.ImageList.Images.SetKeyName(10, "");
            this.ImageList.Images.SetKeyName(11, "");
            this.ImageList.Images.SetKeyName(12, "");
            this.ImageList.Images.SetKeyName(13, "");
            this.ImageList.Images.SetKeyName(14, "");
            this.ImageList.Images.SetKeyName(15, "");
            this.ImageList.Images.SetKeyName(16, "");
            this.ImageList.Images.SetKeyName(17, "");
            this.ImageList.Images.SetKeyName(18, "");
            this.ImageList.Images.SetKeyName(19, "");
            this.ImageList.Images.SetKeyName(20, "");
            this.ImageList.Images.SetKeyName(21, "");
            // 
            // m_fg
            // 
            this.m_fg.ColumnInfo = resources.GetString("m_fg.ColumnInfo");
            this.m_fg.Dock = System.Windows.Forms.DockStyle.Fill;
            this.m_fg.Location = new System.Drawing.Point(0, 88);
            this.m_fg.Name = "m_fg";
            this.m_fg.Size = new System.Drawing.Size(945, 321);
            this.m_fg.Styles = new C1.Win.C1FlexGrid.CellStyleCollection(resources.GetString("m_fg.Styles"));
            this.m_fg.TabIndex = 20;
            // 
            // groupBox1
            // 
            this.groupBox1.Controls.Add(this.m_cmd_them_ghi_chu);
            this.groupBox1.Controls.Add(this.m_lbl_title);
            this.groupBox1.Controls.Add(this.m_lbl_lich_nhac_viec_tu);
            this.groupBox1.Controls.Add(this.m_chk_da_thuc_hien);
            this.groupBox1.Controls.Add(this.m_lbl_lich_nhac_viec_den);
            this.groupBox1.Controls.Add(this.m_cmd_filter);
            this.groupBox1.Controls.Add(this.m_dat_from_date);
            this.groupBox1.Controls.Add(this.label3);
            this.groupBox1.Controls.Add(this.m_dat_to_date);
            this.groupBox1.Controls.Add(this.m_cbo_loai_nhac_viec);
            this.groupBox1.Dock = System.Windows.Forms.DockStyle.Top;
            this.groupBox1.Location = new System.Drawing.Point(0, 0);
            this.groupBox1.Name = "groupBox1";
            this.groupBox1.Size = new System.Drawing.Size(945, 88);
            this.groupBox1.TabIndex = 33;
            this.groupBox1.TabStop = false;
            this.groupBox1.Text = "Thông tin lọc";
            // 
            // m_cmd_them_ghi_chu
            // 
            this.m_cmd_them_ghi_chu.Image = ((System.Drawing.Image)(resources.GetObject("m_cmd_them_ghi_chu.Image")));
            this.m_cmd_them_ghi_chu.ImageAlign = System.Drawing.ContentAlignment.TopLeft;
            this.m_cmd_them_ghi_chu.Location = new System.Drawing.Point(825, 43);
            this.m_cmd_them_ghi_chu.Name = "m_cmd_them_ghi_chu";
            this.m_cmd_them_ghi_chu.Size = new System.Drawing.Size(104, 23);
            this.m_cmd_them_ghi_chu.TabIndex = 32;
            this.m_cmd_them_ghi_chu.Text = "     Thêm ghi chú";
            this.m_cmd_them_ghi_chu.UseVisualStyleBackColor = true;
            // 
            // m_lbl_title
            // 
            this.m_lbl_title.Dock = System.Windows.Forms.DockStyle.Top;
            this.m_lbl_title.Font = new System.Drawing.Font("Microsoft Sans Serif", 12F, System.Drawing.FontStyle.Bold, System.Drawing.GraphicsUnit.Point, ((byte)(0)));
            this.m_lbl_title.ForeColor = System.Drawing.Color.Red;
            this.m_lbl_title.Location = new System.Drawing.Point(3, 16);
            this.m_lbl_title.Name = "m_lbl_title";
            this.m_lbl_title.Size = new System.Drawing.Size(939, 20);
            this.m_lbl_title.TabIndex = 31;
            this.m_lbl_title.Text = "LỊCH NHẮC VIỆC";
            this.m_lbl_title.TextAlign = System.Drawing.ContentAlignment.TopCenter;
            // 
            // m_lbl_lich_nhac_viec_tu
            // 
            this.m_lbl_lich_nhac_viec_tu.AutoSize = true;
            this.m_lbl_lich_nhac_viec_tu.Location = new System.Drawing.Point(18, 50);
            this.m_lbl_lich_nhac_viec_tu.Name = "m_lbl_lich_nhac_viec_tu";
            this.m_lbl_lich_nhac_viec_tu.Size = new System.Drawing.Size(49, 13);
            this.m_lbl_lich_nhac_viec_tu.TabIndex = 22;
            this.m_lbl_lich_nhac_viec_tu.Text = "Hôm nay";
            // 
            // m_chk_da_thuc_hien
            // 
            this.m_chk_da_thuc_hien.AutoSize = true;
            this.m_chk_da_thuc_hien.Location = new System.Drawing.Point(580, 49);
            this.m_chk_da_thuc_hien.Name = "m_chk_da_thuc_hien";
            this.m_chk_da_thuc_hien.Size = new System.Drawing.Size(87, 17);
            this.m_chk_da_thuc_hien.TabIndex = 30;
            this.m_chk_da_thuc_hien.Text = "Đã thực hiện";
            this.m_chk_da_thuc_hien.UseVisualStyleBackColor = true;
            this.m_chk_da_thuc_hien.Visible = false;
            // 
            // m_lbl_lich_nhac_viec_den
            // 
            this.m_lbl_lich_nhac_viec_den.AutoSize = true;
            this.m_lbl_lich_nhac_viec_den.Location = new System.Drawing.Point(186, 55);
            this.m_lbl_lich_nhac_viec_den.Name = "m_lbl_lich_nhac_viec_den";
            this.m_lbl_lich_nhac_viec_den.Size = new System.Drawing.Size(27, 13);
            this.m_lbl_lich_nhac_viec_den.TabIndex = 23;
            this.m_lbl_lich_nhac_viec_den.Text = "Đến";
            this.m_lbl_lich_nhac_viec_den.Visible = false;
            // 
            // m_cmd_filter
            // 
            this.m_cmd_filter.Image = ((System.Drawing.Image)(resources.GetObject("m_cmd_filter.Image")));
            this.m_cmd_filter.ImageAlign = System.Drawing.ContentAlignment.TopLeft;
            this.m_cmd_filter.Location = new System.Drawing.Point(735, 43);
            this.m_cmd_filter.Name = "m_cmd_filter";
            this.m_cmd_filter.Size = new System.Drawing.Size(64, 23);
            this.m_cmd_filter.TabIndex = 28;
            this.m_cmd_filter.Text = "     Xem";
            this.m_cmd_filter.UseVisualStyleBackColor = true;
            // 
            // m_dat_from_date
            // 
            this.m_dat_from_date.CustomFormat = "dd/MM/yyyy";
            this.m_dat_from_date.Format = System.Windows.Forms.DateTimePickerFormat.Custom;
            this.m_dat_from_date.Location = new System.Drawing.Point(71, 48);
            this.m_dat_from_date.Name = "m_dat_from_date";
            this.m_dat_from_date.Size = new System.Drawing.Size(111, 20);
            this.m_dat_from_date.TabIndex = 24;
            // 
            // label3
            // 
            this.label3.AutoSize = true;
            this.label3.Location = new System.Drawing.Point(333, 55);
            this.label3.Name = "label3";
            this.label3.Size = new System.Drawing.Size(77, 13);
            this.label3.TabIndex = 27;
            this.label3.Text = "Loại công việc";
            // 
            // m_dat_to_date
            // 
            this.m_dat_to_date.CustomFormat = "dd/MM/yyyy";
            this.m_dat_to_date.Format = System.Windows.Forms.DateTimePickerFormat.Custom;
            this.m_dat_to_date.Location = new System.Drawing.Point(229, 48);
            this.m_dat_to_date.Name = "m_dat_to_date";
            this.m_dat_to_date.Size = new System.Drawing.Size(91, 20);
            this.m_dat_to_date.TabIndex = 25;
            this.m_dat_to_date.Value = new System.DateTime(2012, 9, 23, 19, 12, 0, 0);
            // 
            // m_cbo_loai_nhac_viec
            // 
            this.m_cbo_loai_nhac_viec.DisplayMember = "Tất cả";
            this.m_cbo_loai_nhac_viec.DropDownStyle = System.Windows.Forms.ComboBoxStyle.DropDownList;
            this.m_cbo_loai_nhac_viec.FormattingEnabled = true;
            this.m_cbo_loai_nhac_viec.Location = new System.Drawing.Point(416, 47);
            this.m_cbo_loai_nhac_viec.Name = "m_cbo_loai_nhac_viec";
            this.m_cbo_loai_nhac_viec.Size = new System.Drawing.Size(148, 21);
            this.m_cbo_loai_nhac_viec.TabIndex = 26;
            this.m_cbo_loai_nhac_viec.ValueMember = "Tất cả";
            // 
            // f800_rpt_nhac_viec
            // 
            this.AutoScaleBaseSize = new System.Drawing.Size(5, 13);
            this.ClientSize = new System.Drawing.Size(945, 409);
            this.Controls.Add(this.m_fg);
            this.Controls.Add(this.groupBox1);
            this.Name = "f800_rpt_nhac_viec";
            this.Text = "F800 - Lịch nhắc việc";
            this.Load += new System.EventHandler(this.f800_rpt_nhac_viec_Load);
            ((System.ComponentModel.ISupportInitialize)(this.m_fg)).EndInit();
            this.groupBox1.ResumeLayout(false);
            this.groupBox1.PerformLayout();
            this.ResumeLayout(false);

		}
		#endregion

		#region Public Interface
		public void display(){			
			this.ShowDialog();
		}
        public void display_in_container(System.Windows.Forms.Control i_objContainer)
        {
            m_ctlGroup = i_objContainer;
            this.TopLevel = false;
            this.FormBorderStyle = FormBorderStyle.None;
            this.Top = 0;
            this.Left = 0;
            this.Height = i_objContainer.Height;
            this.Width = i_objContainer.Width;
            this.Dock = DockStyle.Fill;
            if (CAppContext_201.getCurrentUserID() == 0) return;
            i_objContainer.Controls.Add(this);
            set_start_form();
            this.Show();
        }
		#endregion

		#region Data Structure
		private enum e_col_Number{
			GHI_CHU = 4,LOAI_NHAC_VIEC = 1,NOI_DUNG_NHAC = 2,SO_NGAY_NHAC_TRUOC = 3
		}			
		#endregion

		#region Members
        System.Windows.Forms.Control m_ctlGroup;
        ITransferDataRow m_obj_trans;		
		DS_GD_NHAC_VIEC m_ds = new DS_GD_NHAC_VIEC();
		US_GD_NHAC_VIEC m_us = new US_GD_NHAC_VIEC();
		#endregion

		#region Private Methods
		private void format_controls(){
			CControlFormat.setFormStyle(this);
			CControlFormat.setC1FlexFormat(m_fg);
			set_define_events();
			this.KeyPreview = true;		
		}
		private void set_initial_form_load(){						
			m_obj_trans = get_trans_object(m_fg);
			load_data_2_grid();		
		}	
		private ITransferDataRow get_trans_object(C1.Win.C1FlexGrid.C1FlexGrid i_fg){
			Hashtable v_htb = new Hashtable();
			v_htb.Add(GD_NHAC_VIEC.GHI_CHU, e_col_Number.GHI_CHU);			v_htb.Add(GD_NHAC_VIEC.LOAI_NHAC_VIEC, e_col_Number.LOAI_NHAC_VIEC);			v_htb.Add(GD_NHAC_VIEC.NOI_DUNG_NHAC, e_col_Number.NOI_DUNG_NHAC);			v_htb.Add(GD_NHAC_VIEC.SO_NGAY_NHAC_TRUOC, e_col_Number.SO_NGAY_NHAC_TRUOC);									
			ITransferDataRow v_obj_trans = new CC1TransferDataRow(i_fg,v_htb,m_ds.GD_NHAC_VIEC.NewRow());
			return v_obj_trans;			
		}
		private void load_data_2_grid(){						
			m_ds = new DS_GD_NHAC_VIEC();
            m_us.FillDataset_Lich_nhac_viec(m_ds
                , m_dat_from_date.Value.Date
                , m_dat_to_date.Value.Date
                , CIPConvert.ToDecimal(m_cbo_loai_nhac_viec.SelectedValue));
			m_fg.Redraw = false;
			CGridUtils.Dataset2C1Grid(m_ds, m_fg, m_obj_trans);
			m_fg.Redraw = true;
		}
		private void grid2us_object(US_GD_NHAC_VIEC i_us
			, int i_grid_row) {
			DataRow v_dr;
			v_dr = (DataRow) m_fg.Rows[i_grid_row].UserData;
			m_obj_trans.GridRow2DataRow(i_grid_row,v_dr);
			i_us.DataRow2Me(v_dr);
		}

        private void set_start_form()
        {
            m_obj_trans = get_trans_object(m_fg);
            load_data_2_cbo_loai_nhac_viec();
            m_dat_to_date.Value = m_dat_from_date.Value;
            m_dat_to_date.Visible = false;
            load_data_2_grid();
        }
		private void us_object2grid(US_GD_NHAC_VIEC i_us
			, int i_grid_row) {
			DataRow v_dr = (DataRow) m_fg.Rows[i_grid_row].UserData;
			i_us.Me2DataRow(v_dr);
			m_obj_trans.DataRow2GridRow(v_dr, i_grid_row);
		}

        private void load_data_2_cbo_loai_nhac_viec()
        {
            US_CM_DM_TU_DIEN v_us_tu_dien = new US_CM_DM_TU_DIEN();
            DS_CM_DM_TU_DIEN v_ds_tu_dien = new DS_CM_DM_TU_DIEN();
            v_us_tu_dien.fill_tu_dien_cung_loai_ds("LOAI_NHAC_NHAC_VIEC", v_ds_tu_dien);
            v_ds_tu_dien.EnforceConstraints = false;
            DataRow v_dr = v_ds_tu_dien.CM_DM_TU_DIEN.NewCM_DM_TU_DIENRow();
            v_dr[CM_DM_TU_DIEN.ID] = -1;
            v_dr[CM_DM_TU_DIEN.TEN] = "Tất cả";
            v_ds_tu_dien.CM_DM_TU_DIEN.Rows.InsertAt(v_dr, 0);

            m_cbo_loai_nhac_viec.ValueMember = CM_DM_TU_DIEN.ID;
            m_cbo_loai_nhac_viec.DisplayMember = CM_DM_TU_DIEN.TEN;
            m_cbo_loai_nhac_viec.DataSource = v_ds_tu_dien.CM_DM_TU_DIEN;
        }
		private void insert_gd_nhac_viec(){			
		//	f800_rpt_nhac_viec_DE v_fDE = new  f800_rpt_nhac_viec_DE();								
		//	v_fDE.display();
			load_data_2_grid();
		}

		private void update_gd_nhac_viec(){			
			if (!CGridUtils.IsThere_Any_NonFixed_Row(m_fg)) return;
			if (!CGridUtils.isValid_NonFixed_RowIndex(m_fg, m_fg.Row)) return;			
			grid2us_object(m_us, m_fg.Row);
		//	f800_rpt_nhac_viec_DE v_fDE = new f800_rpt_nhac_viec_DE();
		//	v_fDE.display(m_us);
			load_data_2_grid();
		}
				
		private void delete_gd_nhac_viec(){
			if (!CGridUtils.IsThere_Any_NonFixed_Row(m_fg)) return;
			if (!CGridUtils.isValid_NonFixed_RowIndex(m_fg, m_fg.Row)) return;
			if (BaseMessages.askUser_DataCouldBeDeleted(8) != BaseMessages.IsDataCouldBeDeleted.CouldBeDeleted)  return;
			US_GD_NHAC_VIEC v_us = new US_GD_NHAC_VIEC();
			grid2us_object(v_us, m_fg.Row);
			try {			
				v_us.BeginTransaction();    											
				v_us.Delete();                      								
				v_us.CommitTransaction();
				m_fg.Rows.Remove(m_fg.Row);				
			}
			catch (Exception v_e) {
				v_us.Rollback();
				CDBExceptionHandler v_objErrHandler = new CDBExceptionHandler(v_e,
					new CDBClientDBExceptionInterpret());
				v_objErrHandler.showErrorMessage();
			}
		}

		private void view_gd_nhac_viec(){			
			if (!CGridUtils.IsThere_Any_NonFixed_Row(m_fg)) return;
			if (!CGridUtils.isValid_NonFixed_RowIndex(m_fg, m_fg.Row)) return;
			grid2us_object(m_us, m_fg.Row);
		//	f800_rpt_nhac_viec_DE v_fDE = new f800_rpt_nhac_viec_DE();			
		//	v_fDE.display(m_us);
		}
		private void set_define_events(){
		}
		#endregion

//
		//
		//		EVENT HANLDERS
		//
		//
		private void f800_rpt_nhac_viec_Load(object sender, System.EventArgs e) {
			try{
				set_initial_form_load();
			}
			catch (Exception v_e){
				CSystemLog_301.ExceptionHandle(v_e);
			}
		
		}

		private void m_cmd_exit_Click(object sender, EventArgs e) {
			try{
				this.Close();
			}
			catch (Exception v_e){
				CSystemLog_301.ExceptionHandle(v_e);
			}
		}

		private void m_cmd_insert_Click(object sender, EventArgs e) {
			try{
				insert_gd_nhac_viec();
			}
			catch (Exception v_e){
				CSystemLog_301.ExceptionHandle(v_e);
			}
		}

		private void m_cmd_update_Click(object sender, EventArgs e) {
			try{
				update_gd_nhac_viec();
			}
			catch (Exception v_e){
				CSystemLog_301.ExceptionHandle(v_e);
			}
		}

		private void m_cmd_delete_Click(object sender, EventArgs e) {
			try{
				delete_gd_nhac_viec();
			}
			catch (Exception v_e){
				CSystemLog_301.ExceptionHandle(v_e);
			}
		}

		private void m_cmd_view_Click(object sender, EventArgs e) {
			try{
				view_gd_nhac_viec();
			}
			catch (Exception v_e){
				CSystemLog_301.ExceptionHandle(v_e);
			}
		}

	}
}

